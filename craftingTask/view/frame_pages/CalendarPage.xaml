<!-- Diseño personalizado moderno, redondeado y espacioso para CalendarPage.xaml -->
<Page x:Class="craftingTask.view.frame_pages.CalendarPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local2="clr-namespace:craftingTask.view.helpers"
      mc:Ignorable="d"
      d:DesignWidth="1400" d:DesignHeight="900">

  <Page.Resources>
    <local2:BoolToTodayBrush x:Key="BoolToTodayBrush"/>
    
    <Style x:Key="DayContainerStyle" TargetType="Border">
      <Setter Property="Padding" Value="12"/>
      <Setter Property="CornerRadius" Value="10"/>
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="Margin" Value="4"/>
      <Setter Property="Effect">
        <Setter.Value>
          <DropShadowEffect Color="Black" BlurRadius="5" ShadowDepth="1" Opacity="0.15"/>
        </Setter.Value>
      </Setter>
      <Style.Triggers>
        <DataTrigger Binding="{Binding IsSelected}" Value="True">
          <Setter Property="Background" Value="#2E2E2E"/>
          <Setter Property="BorderBrush" Value="#5A5A5A"/>
          <Setter Property="BorderThickness" Value="1"/>
        </DataTrigger>
        <DataTrigger Binding="{Binding IsToday}" Value="True">
          <Setter Property="Background" Value="#2E2E2E"/>
          <Setter Property="BorderBrush" Value="#5A5A5A"/>
          <Setter Property="BorderThickness" Value="2"/>
        </DataTrigger>
        <DataTrigger Binding="{Binding IsPlaceholder}" Value="True">
          <Setter Property="Opacity" Value="0"/>
          <Setter Property="IsHitTestVisible" Value="False"/>
        </DataTrigger>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="#3A3A3A"/>
          <Setter Property="Cursor" Value="Hand"/>
        </Trigger>
      </Style.Triggers>
    </Style>

    <Style TargetType="ToolTip">
      <Setter Property="OverridesDefaultStyle" Value="True"/>
      <Setter Property="HasDropShadow" Value="True"/>
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="ToolTip">
            <Border Background="#2A2A2A"
                        BorderBrush="#3A3A3A"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="10"
                        SnapsToDevicePixels="True"
                        Effect="{DynamicResource DropShadow}">
              <ContentPresenter Content="{TemplateBinding Content}" 
                                      Margin="0" 
                                      HorizontalAlignment="Left"
                                      VerticalAlignment="Top"/>
            </Border>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <DropShadowEffect x:Key="DropShadow" BlurRadius="8" ShadowDepth="2" Color="Black" Opacity="0.25"/>
  </Page.Resources>

  <Border Background="{StaticResource SecondaryBackground}" CornerRadius="10">
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="30"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>

      <Grid Grid.Row="0" Margin="0,0,0,0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="420"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="40"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="#202020" CornerRadius="10 0 0 0"/>
        <Border Grid.Column="1" Background="#181818"/>
        <Border Grid.Column="2" Background="#181818" CornerRadius="0,8,0,0"/>
        <Button Grid.Column="2" x:Name="btnCloseFrame" Click="btnCloseBoardFrame" Style="{StaticResource CloseFrameButton}" 
                Width="15" Height="15" Margin="3,3,13,-7" HorizontalAlignment="Right" VerticalAlignment="Center"/>
      </Grid>

      <Grid Grid.Row="1" Grid.RowSpan="2">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="420"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Panel izquierdo -->
        <Border Grid.Column="0" Background="#202020" CornerRadius="0 0 0 10" Padding="30">
          <StackPanel>
            <TextBlock Text="{Binding SelectedDayString}" FontSize="42" FontWeight="Bold" Foreground="White"/>
            <TextBlock Text="{Binding SelectedDayInfo}" FontSize="16" Margin="0 10 0 20" Foreground="#CBCBCB"/>
            <ItemsControl ItemsSource="{Binding SelectedDayTasks}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border Background="#2A2A2A" CornerRadius="10" BorderBrush="{Binding Color}" BorderThickness="2" Padding="12" Margin="0 0 0 14">
                    <StackPanel>
                      <TextBlock Text="{Binding Title}" FontSize="20" Foreground="White"/>
                      <TextBlock Text="{Binding Description}" FontSize="13" Foreground="#B1B1B1" Margin="0 3 0 0"/>
                      <TextBlock Text="{Binding EndDate, StringFormat='Hasta: {0:dd MMM yyyy}'}" FontSize="12" Foreground="#888" Margin="0 6 0 0"/>
                    </StackPanel>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Border>

        <Border Grid.Column="1" Background="#181818" CornerRadius="0 0 10 0" Padding="40">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="40"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Botones de vista -->
            <StackPanel Grid.Row="0" VerticalAlignment="Center" Orientation="Horizontal" HorizontalAlignment="Left">
              <Button Content="Mensual" Width="100" Height="30" Click="BtnMonthly_Click" Margin="0,0,5,0"
                      Style="{StaticResource FunctionButtonStyle}" Padding="4"/>
              <Button Content="Anual" Width="100" Height="30" Click="BtnYearly_Click"
                      Style="{StaticResource FunctionButtonStyle}" Padding="4"/>
            </StackPanel>


            <StackPanel Grid.Row="1" VerticalAlignment="Top"  Margin="0,100,0,0">
              <!-- Panel mensual -->
              <Grid x:Name="MonthlyPanel">
                <!-- Título del mes -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 -70 0 25">
                  <TextBlock Text="◀" FontSize="32" Margin="0 0 20 0" Cursor="Hand" Foreground="White" MouseDown="PrevMonth_Click"/>
                  <TextBlock Text="{Binding CurrentMonthString}" FontSize="34" Foreground="White" FontWeight="SemiBold"/>
                  <TextBlock Text="▶" FontSize="32" Margin="20 0 0 0" Cursor="Hand" Foreground="White" MouseDown="NextMonth_Click"/>
                </StackPanel>

                <!-- Calendario Mensual -->
                <Grid x:Name="CalendarGrid" Margin="0 0 0 40" Height="600">
                  <ItemsControl x:Name="CalendarItems" ItemsSource="{Binding Days}" Margin="10">
                    <ItemsControl.ItemsPanel>
                      <ItemsPanelTemplate>
                        <UniformGrid Columns="7"/>
                      </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Style="{StaticResource DayContainerStyle}" MouseDown="Day_Click"
            DataContext="{Binding}">
                          <ToolTipService.ToolTip>
                            <TextBlock Text="{Binding TaskSummary}" TextWrapping="Wrap" Foreground="White" FontSize="14"/>
                          </ToolTipService.ToolTip>
                          <Grid>
                            <TextBlock Text="{Binding DayNumber}" HorizontalAlignment="Center" VerticalAlignment="Center"
                   FontSize="20" FontWeight="Bold" Foreground="White"/>
                            <ItemsControl ItemsSource="{Binding TaskDots}" HorizontalAlignment="Right" 
                      VerticalAlignment="Bottom" Margin="0 0 4 4">
                              <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                  <Ellipse Width="8" Height="8" Fill="{Binding Color}" Margin="1"/>
                                </DataTemplate>
                              </ItemsControl.ItemTemplate>
                            </ItemsControl>
                          </Grid>
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </Grid>
              </Grid>

              <!-- Panel anual -->
              <Grid x:Name="YearlyPanel" Visibility="Collapsed">
                <ScrollViewer Height="600" VerticalScrollBarVisibility="Auto" Margin="0 0 0 0">
                  <ScrollViewer.Resources>
                    <Style TargetType="ScrollBar" BasedOn="{StaticResource DarkScrollBarStyle}" />
                  </ScrollViewer.Resources>
                  <StackPanel>
                    <ItemsControl ItemsSource="{Binding YearMonths}">
                      <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                          <UniformGrid Columns="4"/>
                        </ItemsPanelTemplate>
                      </ItemsControl.ItemsPanel>

                      <ItemsControl.ItemTemplate>
                        <DataTemplate>
                          <Border Background="#2A2A2A" CornerRadius="10" Padding="10" Margin="10">
                            <StackPanel>
                              <TextBlock Text="{Binding MonthName}" FontSize="16" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" Margin="0 0 0 10"/>

                              <ItemsControl ItemsSource="{Binding Days}">
                                <ItemsControl.ItemsPanel>
                                  <ItemsPanelTemplate>
                                    <UniformGrid Columns="7"/>
                                  </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                  <DataTemplate>
                                    <Border Margin="1" CornerRadius="3" Background="{Binding IsToday, Converter={StaticResource BoolToTodayBrush}}">
                                      <Grid>
                                        <TextBlock Text="{Binding DayNumber}" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
                                        <ItemsControl ItemsSource="{Binding TaskDots}" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0 0 2 2">
                                          <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                              <Ellipse Width="5" Height="5" Fill="{Binding Color}" Margin="1"/>
                                            </DataTemplate>
                                          </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                      </Grid>
                                    </Border>
                                  </DataTemplate>
                                </ItemsControl.ItemTemplate>
                              </ItemsControl>

                            </StackPanel>
                          </Border>
                        </DataTemplate>
                      </ItemsControl.ItemTemplate>
                    </ItemsControl>
                  </StackPanel>
                </ScrollViewer>
              </Grid>
            </StackPanel>
          </Grid>
        </Border>
      </Grid>
    </Grid>
  </Border>
</Page>