<Page x:Class="craftingTask.view.frame_pages.BoardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:craftingTask.view.frame_pages"
      xmlns:dd="clr-namespace:GongSolutions.Wpf.DragDrop;assembly=GongSolutions.Wpf.DragDrop" xmlns:local1="clr-namespace:craftingTask.view.helpers"
      xmlns:local2="clr-namespace:craftingTask.persistence"
      mc:Ignorable="d" 
      d:DesignWidth="1400" d:DesignHeight="900"
      Title="BoardPage">

  <Page.Resources>
    <local2:PriorityToStringConverter x:Key="PriorityToStringConverter" />
    <DataTemplate x:Key="DefaultAdornerTemplate">
      <Border Background="{StaticResource TaskBackground}" BorderBrush="{Binding Color}" BorderThickness="1" CornerRadius="10" 
              Padding="16" Margin="6" Opacity="1" Width="300">
        <Border.RenderTransform>
          <TranslateTransform X="-130" Y="80"/>
        </Border.RenderTransform>
        <Border.Effect>
          <DropShadowEffect BlurRadius="14" ShadowDepth="2" Opacity="0.4"/>
        </Border.Effect>
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>
          <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="{Binding Title}" Foreground="{StaticResource TaskTitleForeground}" FontWeight="SemiBold" 
                       FontSize="17" TextWrapping="Wrap"/>
            <TextBlock Text="{Binding EndDate}" Foreground="{StaticResource TaskEndDateForeground}" FontSize="12" Margin="0,2,0,0"/>
          </StackPanel>
          <Border Grid.Row="1" Height="1" Background="{StaticResource TaskBorder}" Opacity="0.25" Margin="0,0,0,10"/>
          <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="6">
            <Border CornerRadius="6" Padding="6,2" Margin="6,0,8,0" BorderBrush="{StaticResource TaskPriorityBorder}" 
                    Background="#10FFFFFF">
              <TextBlock Text="{Binding Priority, Converter={StaticResource PriorityToStringConverter}}" Foreground="{StaticResource TaskPriorityForeground}" FontSize="12" 
                         FontWeight="Medium"/>
            </Border>
            <Border CornerRadius="6" Padding="6,2" BorderBrush="{StaticResource TaskTagBorder}" 
                    Background="{StaticResource TaskTagBackground}">
              <TextBlock Text="{Binding Tag}" Foreground="{StaticResource TaskTagForeground}" FontSize="11"/>
            </Border>
          </StackPanel>
        </Grid>
      </Border>
    </DataTemplate>
  </Page.Resources>
  
  <Border Background="{StaticResource SecondaryBackground}" CornerRadius="10">
    <Grid Margin="5">
      <Grid.RowDefinitions>
        <RowDefinition Height="30"/>
        <RowDefinition Height="*"/>
        <RowDefinition Height="30"/>
      </Grid.RowDefinitions>

      <Grid Grid.Row="0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="30"/>
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0" Margin="0,0,10,0">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.7*"/>
            <ColumnDefinition Width="0.7*"/>
            <ColumnDefinition Width="0.7*"/>
            <ColumnDefinition Width="1.5*"/>
          </Grid.ColumnDefinitions>

          <Button x:Name="btnCreateTask" Grid.Column="0" Margin="0,0,2.5,0" Style="{StaticResource FunctionButtonStyle}" Content="Crear Tarea"
                  VerticalAlignment="Center" Padding="0,4" Click="btnCreateTask_Click"/>
          <Button x:Name="btnArchiveTasks" Grid.Column="1" Margin="2.5,0,0,0" Style="{StaticResource FunctionButtonStyle}" Content="Archivar Tareas"
                  VerticalAlignment="Center" Padding="0,4" Click="btnArchiveTasks_Click"/>
        </Grid>
        
        <Button Grid.Column="1" x:Name="btnCloseFrame" Click="btnCloseBoardFrame" Style="{StaticResource CloseFrameButton}" 
                Width="15" Height="15" Margin="3" HorizontalAlignment="Center" VerticalAlignment="Center"/>
      </Grid>
        
      <Grid Grid.Row="2">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="4*"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Button x:Name="btnCreatePanel" Grid.Column="0" Margin="0,0,2.5,0" Style="{StaticResource FunctionButtonStyle}" Content="Crear Panel"
                VerticalAlignment="Center" Padding="50,4" Click="btnCreatePanel_Click"/>
        <Button x:Name="btnDeletePanels" Grid.Column="1" Margin="2.5,0,0,0" Style="{StaticResource FunctionButtonStyle}" Content="Borrar Paneles"
                VerticalAlignment="Center" Padding="50,4" Click="btnDeletePanels_Click"/>
        
        <Button x:Name="btnShowArchiveTasks" Grid.Column="3" Style="{StaticResource FunctionButtonStyle}" Content="Ver Archivo"
                HorizontalAlignment="Right" VerticalAlignment="Center" Padding="50,4" VerticalContentAlignment="Center" Click="btnShowArchiveTasks_Click"/>
      </Grid>

      <Grid Grid.Row="1">
        <ListBox x:Name="panelListBox" ItemsSource="{Binding PanelList}" BorderThickness="0" Margin="0"
                 ScrollViewer.HorizontalScrollBarVisibility="Auto" ScrollViewer.VerticalScrollBarVisibility="Disabled"
                 HorizontalContentAlignment="Stretch" SelectionMode="Single" Background="Transparent"
                 ScrollViewer.CanContentScroll="False">

          <ListBox.Resources>
            <Style TargetType="ScrollBar"
                   BasedOn="{StaticResource DarkHorizontalScrollBarStyle}" />
          </ListBox.Resources>

          <ListBox.ItemsPanel>
            <ItemsPanelTemplate>
              <VirtualizingStackPanel Orientation="Horizontal" VirtualizingStackPanel.IsVirtualizing="False" />
            </ItemsPanelTemplate>
          </ListBox.ItemsPanel>

          <ListBox.ItemContainerStyle>
            <Style TargetType="ListBoxItem">
              <Setter Property="HorizontalContentAlignment" Value="Stretch" />
              <Setter Property="Padding" Value="0" />
              <Setter Property="Margin" Value="0" />
              <Setter Property="Focusable" Value="False" />
              <Setter Property="dd:DragDrop.DropHandler" Value="{Binding RelativeSource={RelativeSource AncestorType=Page}, Path=DefaultDropHandler}" />
              <Setter Property="Template">
                <Setter.Value>
                  <ControlTemplate TargetType="ListBoxItem">
                    <ContentPresenter />
                  </ControlTemplate>
                </Setter.Value>
              </Setter>
            </Style>
          </ListBox.ItemContainerStyle>

          <ListBox.ItemTemplate>
            <DataTemplate>

              <Border Width="350" Padding="10" Margin="10" CornerRadius="12"
              Background="{StaticResource PanelBackground}"
              BorderBrush="{Binding Color}" BorderThickness="2">

                <Grid>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="40" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="5" />
                  </Grid.RowDefinitions>

                  <TextBlock Grid.Row="0" Text="{Binding Name}" Foreground="{Binding Color}"
                     FontSize="16" FontWeight="Bold" Margin="0,0,0,10"
                     HorizontalAlignment="Center" />

                  <ListBox Grid.Row="1" ItemsSource="{Binding TaskList}" Margin="5" Background="{StaticResource PanelBackground}" 
                           BorderThickness="0" ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                           ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.CanContentScroll="False"
                           dd:DragDrop.IsDragSource="True" dd:DragDrop.IsDropTarget="True" dd:DragDrop.UseDefaultDragAdorner="True"
                           dd:DragDrop.DragAdornerTemplate="{StaticResource DefaultAdornerTemplate}">

                    <ListBox.Resources>
                      <Style TargetType="ScrollBar" BasedOn="{StaticResource DarkScrollBarStyle}" />
                    </ListBox.Resources>

                    <ListBox.ItemsPanel>
                      <ItemsPanelTemplate>
                        <VirtualizingStackPanel Orientation="Vertical" />
                      </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>

                    <ListBox.ItemContainerStyle>
                      <Style TargetType="ListBoxItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Setter Property="Margin" Value="0" />
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="BorderThickness" Value="0" />
                        <Setter Property="Template">
                          <Setter.Value>
                            <ControlTemplate TargetType="ListBoxItem">
                              <ContentPresenter />
                            </ControlTemplate>
                          </Setter.Value>
                        </Setter>
                      </Style>
                    </ListBox.ItemContainerStyle>

                    <ListBox.ItemTemplate>
                      <DataTemplate>

                        <Border Background="{StaticResource TaskBackground}" BorderBrush="{Binding Color}" BorderThickness="1"
                                CornerRadius="10" Padding="16" Margin="6,6,6,14">

                          <Grid>
                            <Grid.RowDefinitions>
                              <RowDefinition Height="Auto" />
                              <RowDefinition Height="Auto" />
                              <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0" Margin="0,0,0,10">
                              <TextBlock Text="{Binding Title}"
                                 Foreground="{StaticResource TaskTitleForeground}"
                                 FontWeight="SemiBold" FontSize="17"
                                 TextWrapping="Wrap" />

                              <TextBlock Text="{Binding EndDate}"
                                 Foreground="{StaticResource TaskEndDateForeground}"
                                 FontSize="12" Margin="0,2,0,0" />
                            </StackPanel>

                            <Border Grid.Row="1" Height="1" Background="{StaticResource TaskBorder}"
                            Opacity="0.25" Margin="0,0,0,10" />

                            <StackPanel Grid.Row="2" Orientation="Horizontal"
                                HorizontalAlignment="Right" Margin="6">

                              <Border CornerRadius="6" Padding="6,2" Margin="6,0,8,0"
                              BorderBrush="{StaticResource TaskPriorityBorder}"
                              Background="#10FFFFFF">
                                <TextBlock Text="{Binding Priority, Converter={StaticResource PriorityToStringConverter}}"
                                   Foreground="{StaticResource TaskPriorityForeground}"
                                   FontSize="12" FontWeight="Medium" />
                              </Border>

                              <Border CornerRadius="6" Padding="6,2"
                              BorderBrush="{StaticResource TaskTagBorder}"
                              Background="{StaticResource TaskTagBackground}">
                                <TextBlock Text="{Binding Tag}"
                                   Foreground="{StaticResource TaskTagForeground}"
                                   FontSize="11" />
                              </Border>

                            </StackPanel>
                          </Grid>

                        </Border>
                      </DataTemplate>
                    </ListBox.ItemTemplate>
                  </ListBox>
                </Grid>

              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </Grid>
    </Grid>
  </Border>
</Page>
