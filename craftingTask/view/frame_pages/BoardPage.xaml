<Page x:Class="craftingTask.view.frame_pages.BoardPage" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:dd="clr-namespace:GongSolutions.Wpf.DragDrop;assembly=GongSolutions.Wpf.DragDrop" xmlns:local="clr-namespace:craftingTask.view.frame_pages" xmlns:local1="clr-namespace:craftingTask.view.helpers" xmlns:local2="clr-namespace:craftingTask.persistence" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" d:DesignHeight="900" d:DesignWidth="1400" mc:Ignorable="d">
  <Page.Resources>
    <local2:PriorityToStringConverter x:Key="PriorityToStringConverter" />
    <DataTemplate x:Key="DefaultAdornerTemplate">
      <Border Width="300" Margin="6" Padding="16" Background="{StaticResource TaskBackground}" BorderBrush="{Binding Color}" BorderThickness="1" CornerRadius="10" Opacity="1">
        <Border.RenderTransform>
          <TranslateTransform X="-130" Y="80" />
        </Border.RenderTransform>
        <Border.Effect>
          <DropShadowEffect BlurRadius="14" Opacity="0.4" ShadowDepth="2" />
        </Border.Effect>
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock FontSize="17" FontWeight="SemiBold" Foreground="{StaticResource TaskTitleForeground}" Text="{Binding Title}" TextWrapping="Wrap" />
            <TextBlock Margin="0,2,0,0" FontSize="12" Foreground="{StaticResource TaskEndDateForeground}" Text="{Binding EndDate}" />
          </StackPanel>
          <Border Grid.Row="1" Height="1" Margin="0,0,0,10" Background="{StaticResource TaskBorder}" Opacity="0.25" />
          <StackPanel Grid.Row="2" Margin="6" HorizontalAlignment="Right" Orientation="Horizontal">
            <Border Margin="6,0,8,0" Padding="6,2" Background="#10FFFFFF" BorderBrush="{StaticResource TaskPriorityBorder}" CornerRadius="6">
              <TextBlock FontSize="12" FontWeight="Medium" Foreground="{StaticResource TaskPriorityForeground}" Text="{Binding Priority, Converter={StaticResource PriorityToStringConverter}}" />
            </Border>
            <Border Padding="6,2" Background="{StaticResource TaskTagBackground}" BorderBrush="{StaticResource TaskTagBorder}" CornerRadius="6">
              <TextBlock FontSize="11" Foreground="{StaticResource TaskTagForeground}" Text="{Binding Tag}" />
            </Border>
          </StackPanel>
        </Grid>
      </Border>
    </DataTemplate>
  </Page.Resources>
  <Border Background="{StaticResource SecondaryBackground}" CornerRadius="10">
    <Grid Margin="5">
      <Grid.RowDefinitions>
        <RowDefinition Height="30" />
        <RowDefinition Height="*" />
        <RowDefinition Height="30" />
      </Grid.RowDefinitions>
      <Grid Grid.Row="0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="30" />
        </Grid.ColumnDefinitions>
        <Grid Grid.Column="0" Margin="0,0,10,0">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.8*" />
            <ColumnDefinition Width="0.8*" />
            <ColumnDefinition Width="0.8*" />
            <ColumnDefinition Width="1.5*" />
          </Grid.ColumnDefinitions>
          <Button x:Name="btnCreateTask" Grid.Column="0" Margin="0,0,2.5,0" Padding="0,4" VerticalAlignment="Center" Click="btnCreateTask_Click" Content="Crear Tarea" Style="{StaticResource FunctionButtonStyle}" />
          <Button x:Name="btnArchiveTasks" Grid.Column="1" Margin="2.5,0,0,0" Padding="0,4" VerticalAlignment="Center" Click="btnArchiveTasks_Click" Content="Archivar Tareas" Style="{StaticResource FunctionButtonStyle}" />
        </Grid>
        <Button x:Name="btnCloseFrame" Grid.Column="1" Width="15" Height="15" Margin="3" HorizontalAlignment="Center" VerticalAlignment="Center" Click="btnCloseBoardFrame" Style="{StaticResource CloseFrameButton}" />
      </Grid>
      <Grid Grid.Row="2">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="1.2*" />
          <ColumnDefinition Width="1.2*" />
          <ColumnDefinition Width="3.5*" />
          <ColumnDefinition Width="1.2*" />
        </Grid.ColumnDefinitions>
        <Button x:Name="btnCreatePanel" Grid.Column="0" Margin="0,0,2.5,0" Padding="50,4" VerticalAlignment="Center" Click="btnCreatePanel_Click" Content="Crear Panel" Style="{StaticResource FunctionButtonStyle}" />
        <Button x:Name="btnDeletePanels" Grid.Column="1" Margin="2.5,0,0,0" Padding="50,4" VerticalAlignment="Center" Click="btnDeletePanels_Click" Content="Borrar Paneles" Style="{StaticResource FunctionButtonStyle}" />
        <Button x:Name="btnShowArchiveTasks" Grid.Column="3" Padding="50,4" HorizontalAlignment="Right" VerticalAlignment="Center" VerticalContentAlignment="Center" Click="btnShowArchiveTasks_Click" Content="Ver Archivo" Style="{StaticResource FunctionButtonStyle}" />
      </Grid>
      <Grid Grid.Row="1">
        <ListBox x:Name="panelListBox" Margin="0" HorizontalContentAlignment="Stretch" Background="Transparent" BorderThickness="0" ItemsSource="{Binding PanelList}" ScrollViewer.CanContentScroll="False" ScrollViewer.HorizontalScrollBarVisibility="Auto" ScrollViewer.VerticalScrollBarVisibility="Disabled" SelectionMode="Single">
          <ListBox.Resources>
            <Style BasedOn="{StaticResource DarkHorizontalScrollBarStyle}" TargetType="ScrollBar" />
          </ListBox.Resources>
          <ListBox.ItemsPanel>
            <ItemsPanelTemplate>
              <VirtualizingStackPanel Orientation="Horizontal" VirtualizingStackPanel.IsVirtualizing="False" />
            </ItemsPanelTemplate>
          </ListBox.ItemsPanel>
          <ListBox.ItemContainerStyle>
            <Style TargetType="ListBoxItem">
              <Setter Property="HorizontalContentAlignment" Value="Stretch" />
              <Setter Property="Padding" Value="0" />
              <Setter Property="Margin" Value="0" />
              <Setter Property="Focusable" Value="False" />
              <Setter Property="dd:DragDrop.DropHandler" Value="{Binding RelativeSource={RelativeSource AncestorType=Page}, Path=DefaultDropHandler}" />
              <Setter Property="Template">
                <Setter.Value>
                  <ControlTemplate TargetType="ListBoxItem">
                    <ContentPresenter />
                  </ControlTemplate>
                </Setter.Value>
              </Setter>
            </Style>
          </ListBox.ItemContainerStyle>
          <ListBox.ItemTemplate>
            <DataTemplate>
              <Border Width="350" Margin="10" Padding="10" Background="{StaticResource PanelBackground}" BorderBrush="{Binding Color}" BorderThickness="2" CornerRadius="12">
                <Grid>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="40" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="5" />
                  </Grid.RowDefinitions>
                  <TextBlock Grid.Row="0" Margin="0,0,0,10" HorizontalAlignment="Center" FontSize="16" FontWeight="Bold" Foreground="{Binding Color}" Text="{Binding Name}" />
                  <ListBox Grid.Row="1" Margin="5" dd:DragDrop.DragAdornerTemplate="{StaticResource DefaultAdornerTemplate}" dd:DragDrop.IsDragSource="True" dd:DragDrop.IsDropTarget="True" dd:DragDrop.UseDefaultDragAdorner="True" Background="{StaticResource PanelBackground}" BorderThickness="0" ItemsSource="{Binding TaskList}" ScrollViewer.CanContentScroll="False" ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.Resources>
                      <Style BasedOn="{StaticResource DarkScrollBarStyle}" TargetType="ScrollBar" />
                    </ListBox.Resources>
                    <ListBox.ItemsPanel>
                      <ItemsPanelTemplate>
                        <VirtualizingStackPanel Orientation="Vertical" />
                      </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.ItemContainerStyle>
                      <Style TargetType="ListBoxItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Setter Property="Margin" Value="0" />
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="BorderThickness" Value="0" />
                        <Setter Property="Template">
                          <Setter.Value>
                            <ControlTemplate TargetType="ListBoxItem">
                              <ContentPresenter />
                            </ControlTemplate>
                          </Setter.Value>
                        </Setter>
                      </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                      <DataTemplate>
                        <Border Margin="6,6,6,14" Padding="16" Background="{StaticResource TaskBackground}" BorderBrush="{Binding Color}" BorderThickness="1" CornerRadius="10" Cursor="Hand">
                          <Border.InputBindings>
                            <MouseBinding Command="{Binding DataContext.TaskDoubleClickCommand, RelativeSource={RelativeSource AncestorType=Page}}" CommandParameter="{Binding}" MouseAction="LeftDoubleClick" />
                          </Border.InputBindings>
                          <Grid>
                            <Grid.RowDefinitions>
                              <RowDefinition Height="Auto" />
                              <RowDefinition Height="Auto" />
                              <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0" Margin="0,0,0,10">
                              <TextBlock FontSize="17" FontWeight="SemiBold" Foreground="{StaticResource TaskTitleForeground}" Text="{Binding Title}" TextWrapping="Wrap" />
                              <TextBlock Margin="0,2,0,0" FontSize="12" Foreground="{StaticResource TaskEndDateForeground}" Text="{Binding EndDate}" />
                            </StackPanel>
                            <Border Grid.Row="1" Height="1" Margin="0,0,0,10" Background="{StaticResource TaskBorder}" Opacity="0.25" />
                            <StackPanel Grid.Row="2" Margin="6" HorizontalAlignment="Right" Orientation="Horizontal">
                              <Border Margin="6,0,8,0" Padding="6,2" Background="#10FFFFFF" BorderBrush="{StaticResource TaskPriorityBorder}" CornerRadius="6">
                                <TextBlock FontSize="12" FontWeight="Medium" Foreground="{StaticResource TaskPriorityForeground}" Text="{Binding Priority, Converter={StaticResource PriorityToStringConverter}}" />
                              </Border>
                              <Border Padding="6,2" Background="{StaticResource TaskTagBackground}" BorderBrush="{StaticResource TaskTagBorder}" CornerRadius="6">
                                <TextBlock FontSize="11" Foreground="{StaticResource TaskTagForeground}" Text="{Binding Tag}" />
                              </Border>
                            </StackPanel>
                          </Grid>
                        </Border>
                      </DataTemplate>
                    </ListBox.ItemTemplate>
                  </ListBox>
                </Grid>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </Grid>
    </Grid>
  </Border>
</Page>