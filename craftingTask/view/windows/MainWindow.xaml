<Window x:Class="craftingTask.MainWindow" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
        xmlns:local="clr-namespace:craftingTask" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:system="clr-namespace:System;assembly=mscorlib" Width="1700" Height="1000" AllowsTransparency="True" 
        Background="{x:Null}" WindowStartupLocation="CenterScreen" WindowStyle="None" mc:Ignorable="d">
  <Border x:Name="mainBorder" Background="{StaticResource MainBackground}" CornerRadius="12">
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="35" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <Grid x:Name="titleBar" Grid.Row="0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="135" />
          <ColumnDefinition Width="135" />
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="25" />
          <ColumnDefinition Width="25" />
          <ColumnDefinition Width="25" />
          <ColumnDefinition Width="5" />
        </Grid.ColumnDefinitions>
        <Button x:Name="btnMenu" Grid.Column="0" Margin="5,5,2.5,5" Padding="0" Click="btnMenu_Click" Content="Menu" 
                FontSize="10" Style="{StaticResource FunctionButtonStyle}">
          <Button.ContextMenu>
            <ContextMenu Style="{StaticResource ModernContextMenu}">
              <MenuItem x:Name="menuItemBackup" Click="btnBackup_Click" Header="Crear/Restaurar Backup" Style="{StaticResource ModernMenuItem}" />
            </ContextMenu>
          </Button.ContextMenu>
        </Button>
        <Button x:Name="btnFunctions" Grid.Column="1" Margin="2.5,5,5,5" Padding="0" Click="btnFunctions_Click" 
                Content="Funciones" FontSize="10" Style="{StaticResource FunctionButtonStyle}">
          <Button.ContextMenu>
            <ContextMenu Style="{StaticResource ModernContextMenu}">
              <MenuItem x:Name="menuItemReminders" Click="btnShowReminders_Click" Header="Recordatorios" Style="{StaticResource ModernMenuItem}" />
              <MenuItem x:Name="menuItemCalendar" Click="btnCalendarView_Click" Header="Calendario" Style="{StaticResource ModernMenuItem}" />
              <MenuItem x:Name="menuItemSearch" Click="btnOpenSearch_Click" Header="Buscar Tareas" Style="{StaticResource ModernMenuItem}" />
            </ContextMenu>
          </Button.ContextMenu>
        </Button>
        <Grid Grid.Column="3" Grid.ColumnSpan="3">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
          </Grid.ColumnDefinitions>
          <Button x:Name="minimizeButton" Grid.Column="0" Width="15" Height="15" Click="btnMinimizeWindow" Style="{StaticResource MinimizeWindowButton}">
            <Viewbox>
              <Path Width="16" Height="14" HorizontalAlignment="Center" VerticalAlignment="Center" Data="M2,7 L14,7" 
                    Opacity="0.5" Stroke="Black" StrokeThickness="2" />
            </Viewbox>
          </Button>
          <Button x:Name="maximizeButton" Grid.Column="1" Width="15" Height="15" Click="btnMaximizeWindow" Style="{StaticResource MaximizeWindowButton}">
            <Viewbox>
              <Path Width="16" Height="14" Margin="3" VerticalAlignment="Center" Data="M2,2 L14,2 L14,12 L2,12 Z" 
                    Opacity="0.5" Stroke="Black" StrokeThickness="2" />
            </Viewbox>
          </Button>
          <Button x:Name="closeButton" Grid.Column="2" Width="15" Height="15" Click="btnCloseWindow" Style="{StaticResource CloseWindowButton}">
            <Viewbox>
              <Canvas Width="16" Height="14" Margin="2" Opacity="0.5">
                <Path Data="M2,2 L14,12" Stroke="Black" StrokeThickness="2" />
                <Path Data="M14,2 L2,12" Stroke="Black" StrokeThickness="2" />
              </Canvas>
            </Viewbox>
          </Button>
        </Grid>
      </Grid>
      <Grid x:Name="contentArea" Grid.Row="1" Margin="5">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="0.35*" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Border Name="boardsBorder" Grid.Column="0" Margin="10,10,5,10" Background="{StaticResource SecondaryBackground}" CornerRadius="10">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="*" />
              <RowDefinition Height="35" />
            </Grid.RowDefinitions>
            <ListView Grid.Row="0" Margin="5" Background="Transparent" BorderBrush="Transparent" ItemsSource="{Binding BoardList}">
              <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                  <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                  <Setter Property="Background" Value="Transparent" />
                  <Setter Property="BorderThickness" Value="0" />
                  <Setter Property="Padding" Value="0" />
                  <Setter Property="Margin" Value="0" />
                  <Setter Property="Template">
                    <Setter.Value>
                      <ControlTemplate TargetType="ListViewItem">
                        <Border Background="{TemplateBinding Background}" BorderThickness="0">
                          <ContentPresenter />
                        </Border>
                      </ControlTemplate>
                    </Setter.Value>
                  </Setter>
                  <EventSetter Event="PreviewMouseLeftButtonDown" Handler="ListViewItem_MouseDoubleClick" />
                </Style>
              </ListView.ItemContainerStyle>
              <ListView.ItemTemplate>
                <DataTemplate>
                  <Button HorizontalAlignment="Stretch" Style="{StaticResource InvisibleButton}">
                    <Button.ContextMenu>
                      <ContextMenu Style="{StaticResource ModernContextMenu}">
                        <MenuItem Click="EditBoard_Click" Header="Modificar Tablero" Style="{StaticResource ModernMenuItem}" />
                      </ContextMenu>
                    </Button.ContextMenu>
                    <Grid Margin="2,2.5,2,2.5">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="8" />
                        <ColumnDefinition Width="*" />
                      </Grid.ColumnDefinitions>
                      <Border Grid.Column="0" Grid.ColumnSpan="2" Width="auto" Padding="15" Background="#181818" CornerRadius="8">
                        <StackPanel Margin="30,0,0,0">
                          <TextBlock FontSize="14" FontWeight="Bold" Foreground="White" Text="{Binding Name}" />
                          <TextBlock Margin="0,8,0,0" FontSize="9" Foreground="White" Text="{Binding CreationDate}" />
                        </StackPanel>
                      </Border>
                      <Border Grid.Column="0" Width="10" HorizontalAlignment="Left" Background="{Binding Color}" CornerRadius="8 0 0 8" />
                    </Grid>
                  </Button>
                </DataTemplate>
              </ListView.ItemTemplate>
            </ListView>
            <Grid Grid.Row="1">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="0.7*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>
              <Button x:Name="btnCreateBoard" Grid.Column="1" Margin="0,2.5,2.5,2.5" Padding="0,3" VerticalAlignment="Center" 
                      Click="btnCreateBoard_Click" Content="Crear Tablero" Style="{StaticResource FunctionButtonStyle}" />
              <Button x:Name="btnDeleteBoards" Grid.Column="2" Margin="2.5" Padding="0,3" VerticalAlignment="Center" 
                      Click="btnDeleteBoards_Click" Content="Borrar Tableros" Style="{StaticResource FunctionButtonStyle}" />
            </Grid>
          </Grid>
        </Border>
        <TextBlock Name="welcomeMessage" Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center" 
                   FontFamily="Poppins" FontSize="28" Foreground="{StaticResource BackgroundForeground}" Text="Welcome to Kadro" />
        <Frame Name="boardsFrame" Grid.Column="1" Margin="5,10,10,10" Navigated="BoardsFrame_Navigated" NavigationUIVisibility="Hidden" />
      </Grid>
      <Popup x:Name="NotificationPopup" AllowsTransparency="True" IsOpen="False" Placement="Relative" 
             PlacementTarget="{Binding ElementName=contentArea}" StaysOpen="True">
        <Border MinWidth="280" MaxWidth="350" Padding="16,12" Background="{StaticResource TaskBackground}" 
                BorderBrush="{StaticResource TaskBorder}" BorderThickness="1" CornerRadius="10">
          <Border.Effect>
            <DropShadowEffect BlurRadius="15" Direction="270" Opacity="0.5" ShadowDepth="3" Color="Black" />
          </Border.Effect>
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid Grid.Row="0" Margin="0,0,0,8">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>
              <TextBlock Grid.Column="0" Margin="0,0,8,0" VerticalAlignment="Center" FontSize="20" Text="⏰" />
              <TextBlock Grid.Column="1" VerticalAlignment="Center" FontSize="14" FontWeight="SemiBold" 
                         Foreground="{StaticResource TaskTitleForeground}" Text="Recordatorio de Tareas" />
              <Button x:Name="btnCloseNotification" Grid.Column="2" Width="20" Height="20" VerticalAlignment="Center" 
                      Click="btnCloseNotification_Click" Cursor="Hand" Style="{StaticResource InvisibleButton}">
                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16" Foreground="{StaticResource SecondaryForeground}" Text="✕" />
              </Button>
            </Grid>
            <TextBlock x:Name="txtNotificationMessage" Grid.Row="1" Margin="0,0,0,12" FontSize="13" 
                       Foreground="{StaticResource SecondaryForeground}" LineHeight="18" Text="Tienes 5 tareas próximas a vencer" TextWrapping="Wrap" />
            <Button x:Name="btnViewReminders" Grid.Row="2" Padding="0,6" HorizontalAlignment="Stretch" 
                    Click="btnViewReminders_Click" Content="Ver Recordatorios" Style="{StaticResource FunctionButtonStyle}" />
          </Grid>
        </Border>
      </Popup>
    </Grid>
  </Border>
</Window>
